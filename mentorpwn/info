"  if(!preg_match("#union|sub|lenght|c"

"length" is mispelled.  possible injection point. 
